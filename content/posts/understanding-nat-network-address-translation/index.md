---
title: "NAT(Network Address Translation) 이해하기"
date: 2025-05-01T19:46:09+09:00
draft: false
description: "NAT(Network Address Translation)에 대한 기본 개념과 종류, 동작 원리 및 장단점에 대해 설명합니다."
tags:
    [
        "네트워크",
        "NAT",
        "SNAT",
        "DNAT",
        "IP 주소",
        "네트워크 보안",
        "포트 포워딩",
        "방화벽",
        "라우터",
        "PAT",
    ]
---

## 서론

NAT(Network Address Translation)는 네트워크 통신에서 사설 IP 주소와 공인 IP 주소 사이를 중재하는 핵심 기술이다. 이는 1990년대 중반 IPv4 주소 고갈 문제에 대응하기 위해 등장했으며, IETF의 RFC 1631 문서를 통해 처음 표준화되었다. NAT는 현재 가정용 공유기부터 대규모 기업 네트워크, 클라우드 인프라에 이르기까지 전 세계 인터넷 인프라의 근간을 이루는 필수 기술로 자리잡았다.

## NAT의 기본 개념

NAT는 라우터나 방화벽과 같은 네트워크 장비에서 동작하며, 내부 네트워크(사설 IP)와 외부 네트워크(공인 IP) 간의 IP 주소를 변환한다. 이 과정에서 패킷 헤더의 IP 주소와 TCP/UDP 포트 번호를 수정하고, NAT 테이블에 변환 정보를 기록하여 양방향 통신을 가능하게 한다. RFC 1918에 정의된 사설 IP 주소 대역(10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16)은 이러한 NAT 환경에서 내부 네트워크 구성에 광범위하게 활용된다. 패킷이 NAT 장비를 통과할 때 체크섬(checksum)도 함께 재계산되며, 이는 IP와 TCP/UDP 헤더의 무결성을 보장하는 데 필수적이다.

## NAT의 종류

### 1. 정적 NAT (Static NAT)

정적 NAT는 하나의 사설 IP 주소와 하나의 공인 IP 주소를 1:1로 매핑하는 방식이다. 이 방식은 주로 외부에서 내부의 특정 서버(웹, 메일, 게임, 데이터베이스 등)로 항상 접근해야 할 때 사용된다. 매핑 관계는 NAT 장비의 설정에 의해 영구적으로 유지되며, 시스템이 재시작되어도 그대로 유지된다.

**예시:**

-   내부 웹 서버 192.168.1.10 → 공인 IP 203.0.113.10
-   내부 메일 서버 192.168.1.20 → 공인 IP 203.0.113.20
-   외부 사용자가 203.0.113.10:80으로 접근하면 NAT 장비가 내부 웹 서버(192.168.1.10:80)로 트래픽을 정확히 전달한다.

**특징:**

-   설정이 고정되어 있어 예측 가능하고 안정적이다.
-   양방향 연결이 완벽하게 지원되어 복잡한 프로토콜도 문제없이 작동한다.
-   많은 수의 공인 IP가 필요하여 IP 주소 절약 효과가 적다는 단점이 있다.
-   대규모 네트워크에서는 관리 부담이 가중된다.

### 2. 동적 NAT (Dynamic NAT)

동적 NAT는 여러 개의 공인 IP 풀(pool) 중에서 사용 가능한 IP를 내부 호스트에 동적으로 할당하는 방식이다. 연결이 종료되면 해당 공인 IP는 풀로 반환되어 다른 내부 장치가 사용할 수 있게 된다.

**예시:**

-   공인 IP 풀: 203.0.113.10 ~ 203.0.113.20
-   내부 호스트 A(192.168.1.5)가 외부 접속 시 203.0.113.10 할당 받음
-   내부 호스트 B(192.168.1.6)가 외부 접속 시 203.0.113.11 할당 받음
-   호스트 A의 연결이 종료되면 203.0.113.10은 풀로 반환되어 다른 호스트가 사용 가능

**특징:**

-   정적 NAT보다 유연하게 IP를 관리할 수 있으며 IP 활용도가 높다.
-   공인 IP가 필요한 시점에만 할당되므로 자원 효율성이 좋다.
-   IP 풀이 소진되면 추가 외부 접속이 불가능하여 트래픽 폭증 시 병목현상이 발생할 수 있다.
-   외부에서 내부로의 연결 시작이 어려워 서버 운영에는 적합하지 않다.

### 3. PAT (Port Address Translation) / NAPT

PAT(Port Address Translation) 또는 NAPT(Network Address Port Translation)는 가장 보편적으로 사용되는 NAT 방식으로, 하나의 공인 IP를 여러 내부 IP가 공유한다. 이때 TCP/UDP 포트 번호를 변경하여 각 연결을 구분하며, 상태 테이블을 통해 각 세션을 추적한다.

**예시:**

-   내부 호스트 A(192.168.1.2:1234)가 외부 접속 → 203.0.113.1:40000으로 변환
-   내부 호스트 B(192.168.1.3:1234)가 동일한 포트로 외부 접속 → 203.0.113.1:40001로 변환
-   내부 호스트 A가 다른 포트(5678)로 추가 접속 → 203.0.113.1:40002로 변환

**특징:**

-   가정용 공유기와 소규모 기업 네트워크에서 기본적으로 사용되는 방식이다.
-   하나의 공인 IP로 수만 개의 동시 연결을 지원할 수 있어 IP 주소 절약 효과가 극대화된다.
-   TCP/UDP 포트 번호의 범위(0-65535)로 인해 이론적으로 단일 IP당 최대 약 65,000개의 동시 연결로 제한된다.
-   FTP, SIP, H.323과 같이 패킷 페이로드에 IP 주소 정보를 포함하는 프로토콜은 추가적인 처리(ALG, Application Layer Gateway)가 필요하다.

### 4. DNAT (Destination NAT)

DNAT는 외부에서 들어오는 패킷의 목적지 주소를 내부 IP로 변경하는 방식이다. 이 방식은 주로 외부 사용자가 내부 서버에 접근할 수 있도록 하면서도 내부 네트워크의 구조를 은닉하기 위해 사용된다. 포트 포워딩이 DNAT의 대표적인 예시이며, 특정 포트로 들어오는 트래픽만 선택적으로 내부의 특정 서버로 전달할 수 있다.

**예시:**

-   외부에서 공인 IP 203.0.113.1:80으로 접속 → 내부 웹 서버 192.168.1.10:80으로 전달
-   외부에서 공인 IP 203.0.113.1:443으로 접속 → 내부 웹 서버 192.168.1.10:443으로 전달
-   외부에서 공인 IP 203.0.113.1:22로 접속 → 내부 SSH 서버 192.168.1.20:22로 전달
-   외부에서 공인 IP 203.0.113.1:25로 접속 → 내부 메일 서버 192.168.1.30:25로 전달

**활용 분야:**

-   웹 서버, 메일 서버, 게임 서버 등을 내부에서 운영하면서 외부에 서비스 제공
-   포트 포워딩을 통한 원격 접속 환경 구성
-   DMZ(Demilitarized Zone) 구성으로 내부 네트워크 보안과 외부 서비스 제공의 균형 유지
-   역방향 프록시(Reverse Proxy) 시스템 구현
-   로드 밸런서를 통한 트래픽 분산 처리

**특징:**

-   내부 서버의 실제 IP 주소를 외부에 노출하지 않으면서도 서비스 제공이 가능하다.
-   다수의 내부 서버를 하나의 공인 IP로 외부에 노출할 수 있어 IP 주소 절약과 서버 운영을 동시에 달성할 수 있다.
-   세밀한 방화벽 규칙과 결합하여 특정 서비스에 대한 접근만 허용함으로써 보안을 강화할 수 있다.
-   대규모 서비스 환경에서는 여러 DNAT 규칙이 복잡하게 얽혀 관리 복잡성이 증가할 수 있다.

### 5. SNAT (Source NAT)

SNAT는 내부에서 외부로 나가는 패킷의 출발지 주소를 공인 IP로 변경하는 방식이다. 가장 일반적인 NAT 형태로, 내부 사용자들이 인터넷에 접속할 때 거의 항상 사용된다. PAT도 SNAT의 일종으로 볼 수 있으나, SNAT는 더 넓은 개념으로 출발지 주소 변환 전반을 지칭한다.

**예시:**

-   내부 호스트 192.168.1.10에서 외부로 패킷 전송 → 출발지가 공인 IP 203.0.113.1로 변경됨
-   여러 서버를 포함한 클러스터에서 하나의 공인 IP를 통해 외부 통신 수행
-   멀티호밍(다중 ISP 연결) 환경에서 특정 트래픽의 출발지 IP를 다른 공인 IP로 변경

**활용 분야:**

-   대규모 기업 네트워크에서 수천 대의 내부 장치가 제한된 공인 IP로 인터넷에 접속
-   클라우드 환경에서 가상 머신들의 아웃바운드 트래픽 관리
-   여러 ISP를 사용하는 환경에서 출발지 기반 라우팅(Source Based Routing) 구현
-   고가용성 시스템에서 장애 발생 시 트래픽 출발지 자동 전환

**특징:**

-   내부 네트워크 구조를 외부에 노출하지 않아 보안성이 강화된다.
-   모든 내부 장치가 동일한 공인 IP를 사용하므로 외부에서 일관된 접근 제어가 가능하다.
-   상태 추적(Connection Tracking)을 통해 반환 트래픽을 올바른 내부 호스트로 전달한다.
-   대용량 트래픽 환경에서는 NAT 테이블 관리에 상당한 시스템 리소스가 소모될 수 있다.

## NAT 동작 흐름 상세 분석

실제 NAT 환경에서 패킷이 어떻게 처리되는지 단계별로 살펴보면 NAT의 작동 원리를 더 명확하게 이해할 수 있다. 아래는 PAT(포트 주소 변환) 환경에서 내부 클라이언트가 외부 웹 서버에 접속하는 과정을 세부적으로 분석한 예시다.

### 1. 내부에서 외부로 요청 (아웃바운드 패킷)

1. 내부 호스트(192.168.1.2)가 웹 브라우저를 통해 외부 서버(8.8.8.8:80)에 HTTP 요청을 시도한다.
2. 내부 호스트의 운영체제는 임시 포트(ephemeral port, 예: 1234)를 할당하여 TCP SYN 패킷을 생성한다.
3. 패킷 내용: `소스 IP=192.168.1.2, 소스 포트=1234, 목적지 IP=8.8.8.8, 목적지 포트=80, TCP 플래그=SYN`
4. 이 패킷은 내부 네트워크의 기본 게이트웨이(NAT 장비)로 전송된다.
5. NAT 장비는 해당 패킷을 수신하고 NAT 처리를 시작한다:
    - 패킷의 출발지 IP를 공인 IP(203.0.113.1)로 변경
    - 출발지 포트를 NAT용 임시 포트(40000)로 변경
    - IP와 TCP 헤더의 체크섬을 재계산
    - 변환 정보 `192.168.1.2:1234 ↔ 203.0.113.1:40000`를 NAT 테이블에 기록
6. 변환된 패킷 내용: `소스 IP=203.0.113.1, 소스 포트=40000, 목적지 IP=8.8.8.8, 목적지 포트=80, TCP 플래그=SYN`
7. NAT 장비는 변환된 패킷을 외부 네트워크로 전송한다.

### 2. 외부에서 내부로 응답 (인바운드 패킷)

1. 외부 서버(8.8.8.8:80)는 요청을 처리하고 응답 패킷(TCP SYN-ACK)을 생성한다.
2. 패킷 내용: `소스 IP=8.8.8.8, 소스 포트=80, 목적지 IP=203.0.113.1, 목적지 포트=40000, TCP 플래그=SYN-ACK`
3. 이 응답 패킷은 인터넷을 통해 NAT 장비의 공인 IP로 전송된다.
4. NAT 장비는 패킷을 수신하고, 목적지 IP:포트(203.0.113.1:40000)를 확인한다.
5. NAT 테이블을 조회하여 해당하는 내부 매핑 정보(192.168.1.2:1234)를 찾는다.
6. NAT 처리를 수행한다:
    - 패킷의 목적지 IP를 내부 호스트 IP(192.168.1.2)로 변경
    - 목적지 포트를 원래 호스트 포트(1234)로 변경
    - IP와 TCP 헤더의 체크섬을 다시 재계산
7. 변환된 패킷 내용: `소스 IP=8.8.8.8, 소스 포트=80, 목적지 IP=192.168.1.2, 목적지 포트=1234, TCP 플래그=SYN-ACK`
8. NAT 장비는 변환된 패킷을 내부 네트워크로 전송하고, 패킷은 원래 요청한 호스트에 도달한다.

### 3. 데이터 전송 및 연결 유지

1. TCP 3-way 핸드셰이크가 완료되면 실제 HTTP 데이터 교환이 시작된다.
2. 모든 후속 패킷에 대해서도 동일한 NAT 규칙이 적용된다:
    - 내부→외부: 출발지 192.168.1.2:1234 → 203.0.113.1:40000
    - 외부→내부: 목적지 203.0.113.1:40000 → 192.168.1.2:1234
3. NAT 장비는 연결의 상태를 지속적으로 추적하여 NAT 테이블을 최신 상태로 유지한다.
4. NAT 장비는 일정 시간(타임아웃) 동안 트래픽이 없는 연결 정보를 테이블에서 제거하여 리소스를 효율적으로 관리한다.

### 4. 연결 종료 및 리소스 해제

1. 내부 호스트가 연결 종료를 요청하면 TCP FIN 패킷이 전송된다.
2. NAT 장비는 FIN 패킷도 동일한 NAT 규칙으로 처리한다.
3. 외부 서버도 FIN 패킷으로 응답하고, TCP 4-way 종료 과정이 완료된다.
4. NAT 장비는 연결 종료를 인식하고, 해당 연결에 대한 NAT 테이블 항목에 타임아웃을 설정한다.
5. 타임아웃 후(일반적으로 TCP는 약 60초, UDP는 약 30초), NAT 장비는 해당 매핑 정보를 테이블에서 제거한다.
6. 포트 40000은 다른 내부 호스트의 연결에 재사용될 수 있는 상태가 된다.

위 과정은 기본적인 HTTP 통신 예시이지만, FTP(File Transfer Protocol)와 같은 복잡한 프로토콜은 데이터 채널을 별도로 생성하므로 NAT 장비에서 특별한 처리(ALG, Application Layer Gateway)가 필요하다. ALG는 패킷의 페이로드까지 검사하여 프로토콜이 NAT 환경에서 올바르게 작동하도록 추가적인 변환을 수행한다..113.1:40000`

-   내부 전달: `SRC: 8.8.8.8:80 → DST: 192.168.1.2:1234`

## NAT의 장단점 분석

NAT는 네트워크 환경에서 다양한 측면에 영향을 미치는 기술로, 각각의 장점과 단점을 심층적으로 이해하는 것이 중요하다.

### 보안 측면

**장점:**

-   **내부 네트워크 은닉:** NAT는 내부 네트워크의 실제 IP 주소 체계를 외부로부터 완전히 숨겨, 내부 시스템에 대한 직접적인 공격 벡터를 크게 감소시킨다.
-   **상태 기반 필터링:** 대부분의 NAT 구현은 상태 추적 기능을 통해 내부에서 시작된 연결에 대한 응답만을 허용함으로써 기본적인 방화벽 기능을 제공한다.
-   **주소 스캐닝 방지:** 외부 공격자가 내부 네트워크의 IP 주소 범위를 파악하기 어렵게 만들어 무차별 스캐닝 공격의 효과를 크게 감소시킨다.

**단점:**

-   **세밀한 보안 제어의 어려움:** NAT 자체만으로는 애플리케이션 계층의 보안 위협에 대응하기 어려우며, 추가적인 보안 솔루션이 필요하다.
-   **양방향 연결의 복잡성:** 특정 내부 서버에 대한 외부 접근을 허용하기 위해서는 명시적인 포트 포워딩 규칙이 필요하며, 이는 관리 복잡성을 증가시킨다.
-   **로깅과 감사의 어려움:** 다수의 내부 사용자가 동일한 공인 IP를 공유하므로, 특정 악의적 활동의 출처를 정확히 추적하기 위해서는 세션 단위의 상세한 로깅이 필요하다.

### 주소 관리 측면

**장점:**

-   **IPv4 주소 절약:** 하나의 공인 IP 주소로 수천 개의 내부 장치를 인터넷에 연결할 수 있어 심각한 IPv4 주소 부족 문제를 효과적으로 완화한다.
-   **주소 독립성:** 내부 네트워크의 주소 체계를 ISP나 외부 네트워크와 독립적으로 설계하고 관리할 수 있다.
-   **네트워크 재설계 용이성:** ISP 변경이나 공인 IP 변경 시에도 내부 네트워크 구성을 그대로 유지할 수 있어 관리가 용이하다.

**단점:**

-   **포트 제한:** PAT 환경에서는 TCP/UDP 포트 번호(최대 65,535개)로 인해 단일 공인 IP에서 처리할 수 있는 동시 연결 수에 한계가 존재한다.
-   **주소 충돌 문제:** 기업 합병이나 VPN 연결 시 동일한 사설 IP 대역을 사용하는 네트워크 간 충돌이 발생할 수 있다.
-   **IPv6 전환 지연:** NAT가 IPv4 주소 부족 문제를 완화함으로써 IPv6로의 전환 필요성과 속도를 감소시켰다는 비판이 있다.

### 네트워크 구성 및 관리 측면

**장점:**

-   **간편한 구성:** 대부분의 라우터와 방화벽 장비에서 NAT 기능이 기본 제공되어 설정이 용이하다.
-   **비용 효율성:** 적은 수의 공인 IP로 대규모 네트워크를 운영할 수 있어 IP 주소 구매 및 관리 비용이 절감된다.
-   **유연한 네트워크 설계:** 내부 네트워크 구조 변경이 외부 연결에 영향을 미치지 않아 네트워크 설계의 유연성이 증가한다.

**단점:**

-   **서버 운영의 복잡성:** 내부에서 서비스를 제공하기 위해서는 포트 포워딩이나 DMZ 구성 등 추가적인 설정이 필요하다.
-   **고급 기능 구현의 어려움:** IP 기반의 P2P 애플리케이션, 멀티캐스트, IPsec VPN 등 일부 고급 네트워크 기능은 NAT 환경에서 구현이 어려울 수 있다.
-   **대규모 환경에서의 성능 이슈:** 많은 동시 연결을 처리해야 하는 대규모 환경에서는 NAT 장비의 성능이 병목 현상을 일으킬 수 있다.

### 애플리케이션 호환성 측면

**장점:**

-   **대부분의 애플리케이션 호환성:** 웹 브라우징, 이메일, 파일 다운로드 등 일반적인 인터넷 활동은 NAT 환경에서 문제없이 작동한다.
-   **ALG 지원:** 많은 NAT 장비들이 FTP, SIP 등 복잡한 프로토콜을 위한 ALG(Application Layer Gateway)를 제공한다.
-   **광범위한 사용성:** 전 세계적으로 대부분의 네트워크가 NAT를 사용하고 있어, 많은 애플리케이션이 NAT 환경을 고려하여 설계된다.

**단점:**

-   **일부 프로토콜 제약:** VoIP, 온라인 게임, P2P 파일 공유 등 특수한 프로토콜은 NAT 환경에서 추가적인 처리 없이는 원활하게 작동하지 않을 수 있다.
-   **연결 시작의 비대칭성:** 외부에서 내부로의 연결 시작이 기본적으로 차단되어, 원격 접속이나 서버 운영에 제약이 따른다.
-   **NAT 트래버설의 필요성:** WebRTC와 같은 기술은 NAT 환경에서 P2P 통신을 위해 STUN, TURN, ICE와 같은 복잡한 NAT 트래버설 기술을 필요로 한다.

## 결론

NAT는 IPv4 환경에서 없어서는 안 될 핵심 기술 중 하나이다. 특히 PAT 방식은 가정과 기업에서 보편적으로 사용되며, 공인 IP 부족 문제를 우회하는 현실적인 해결책을 제공하고 있다. IPv6의 도입으로 NAT의 필요성이 점차 줄어들고 있으나, 현재까지는 여전히 널리 사용되고 있는 기술이다. NAT의 다양한 방식과 동작 원리를 이해한다면, 네트워크 트러블슈팅과 구성에 큰 도움이 될 것이다.
